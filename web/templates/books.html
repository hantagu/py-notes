{% extends "base.html" %}
{% block content %}
<div class="card">
    <div class="card-header">Создать новую записную книжку</div>
    <div class="card-body">
        <input type="text" class="form-control" id="create_book_title" placeholder="Название">
    </div>
    <div class="card-footer">
        <button type="button" class="btn btn-outline-success" id="create_book_submit">Создать</button>
    </div>
</div>

<div class="d-flex justify-content-center mt-4" id="spinner">
    <div class="spinner-border spinner-border-sm"></div>
</div>

<div class="d-flex justify-content-center mt-4 text-secondary fst-italic" id="no_books_warn" style="display: none !important;">
    У вас пока ещё нет ни одной записной книжки
</div>

<div id="books">
</div>

<script>
    document.addEventListener('DOMContentLoaded', () =>
    {
        const create_book_title = document.getElementById('create_book_title');
        const create_book_submit = document.getElementById('create_book_submit');
        const books = document.getElementById('books');

        const spinner = document.getElementById('spinner');
        const no_books_warn = document.getElementById('no_books_warn');

        create_book_submit.addEventListener('click', () =>
        {
            const title = document.getElementById('create_book_title');

            make_request(METHOD_CREATE_BOOK, {title: title.value.trim()})
                .then(result => {
                    no_books_warn.setAttribute(STYLE, DISPLAY_NONE);
                    books.appendChild(create_book_list_item(result.book));
                    title.value = '';
                })
                .catch(error => {
                    show_alert(error.json? `Ошибка API: ${error.description}` : `Ошибка HTTP: ${error.code} ${error.text}`);
                })
                .finally(() => {
                    spinner.setAttribute(STYLE, DISPLAY_NONE);
                });
        });

        make_request(METHOD_GET_BOOKS)
            .then(result => {
                if (result.books.length <= 0) {
                    no_books_warn.removeAttribute(STYLE);
                    return;
                }
                result.books.forEach(book => {
                    books.appendChild(create_book_list_item(book));
                });
            })
            .catch(error => {
                show_alert(error.json? `Ошибка API: ${error.description}` : `Ошибка HTTP: ${error.code} ${error.text}`);
            })
            .finally(() => {
                spinner.setAttribute(STYLE, DISPLAY_NONE);
            });
    });
</script>
{% endblock %}
